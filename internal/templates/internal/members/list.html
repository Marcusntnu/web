{% extends "internal/base.html" %}
{% load staticfiles %}
{% load l10n %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'internal/css/member-list.css' %}"/>
{% endblock head %}

{% block body %}
    <div class="ui container">
        <h1>Medlemsliste</h1>
        <div class="ui input">
            <input type="text" placeholder="Søk på medlemmer..." id="member-search">
        </div>

        <div class="ui compact menu right floated">
            <a class="item active" data-value="True">
                Aktive
            </a>
            <a class="item" data-value="False">
                Inaktive
            </a>
        </div>

        <table class="ui celled table" id="member-table">
            <thead>
            <tr id="table-header">
                <th>Navn <i class="icon sort down"></i></th>
                <th>Komité <i class="icon sort"></i></th>
                <th>Epost <i class="icon sort"></i></th>
                <th>Telefonnummer <i class="icon sort"></i></th>
                <th>Studieretning <i class="icon sort"></i></th>
                <th>Kortnummer <i class="icon sort"></i></th>
                <th>Internsystemer <i class="icon sort"></i></th>
            </tr>
            </thead>
            {% for member in members %}
                <tr class="member-row" data-search-text="{{ member.get_name }}"
                    data-active="{{ member.active }}">
                    <td data-sort="{{ member.get_name }}">
                        {{ member.get_name }}
                        <span class="right floated">
                            {% if member.user == request.user or perms.internal.can_edit_group_membership %}
                                <a href="{% url "change_member" member %}">
                                    <i class="pencil icon" title="Endre informasjon"></i>
                                </a>
                            {% endif %}
                            {% if member.user == request.user or perms.internal.can_register_new_member %}
                                <a href="{% url "activation_member" member %}" class="activation confirm">
                                <i class="icon {% if member.active %}red{% else %}green{% endif %} flag"
                                   title="Sett medlem til {% if member.active %}in{% endif %}aktivt"></i>
                                <div id="activation-modal" class="ui basic small modal">
                                    <div class="ui icon header">
                                        {% if member.active %}
                                            <i class="red flag icon"></i>
                                            Er du sikker på at du vil deaktivere medlemskapet til brukeren? Dette vil
                                            fjerne brukeren fra alle komitéer og fjerne alle relaterte tilganger.
                                            Styremedlemmer kan reaktiver medlemskapet i etterkant.
                                        {% else %}
                                            <i class="green flag icon"></i>
                                            Er du sikker på at du vil aktivere medlemskapet til brukeren? Dette vil
                                            legge brukeren til komitéene brukeren sist var medlem av, og gi brukeren de
                                            respektive tilgangene.
                                        {% endif %}
                                    </div>
                                    <div class="actions">
                                        <div class="ui red inverted delete button">
                                            {% if member.active %}
                                                <i class="red flag icon"></i>
                                                Deaktiver
                                            {% else %}
                                                <i class="green flag icon"></i>
                                                Aktiver
                                            {% endif %}
                                        </div>
                                        <div class="ui white ok inverted button">
                                            <i class="cancel icon"></i>
                                            {% if member.active %}
                                                Kanseller deaktiveringen
                                            {% else %}
                                                Kanseller aktiveringen
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </a>
                            {% endif %}
                        </span>
                    </td>
                    <td data-sort="{{ member.get_committee }}">
                        {% if member.get_committee %}
                            <span class="mobile-header">Komité: </span>{{ member.get_committee }}
                        {% endif %}
                    </td>
                    <td data-sort="{{ member.email }}">
                        {% if member.email %}
                            <span class="mobile-header">E-post: </span>{{ member.email }}
                        {% endif %}
                    </td>
                    <td data-sort="{{ member.phone_number }}">
                        {% if member.phone_number %}
                            <span class="mobile-header">Telefonnummer: </span>{{ member.phone_number }}
                        {% endif %}
                    </td>
                    <td data-sort="{{ member.study_program }}">
                        {% if member.study_program %}
                            <span class="mobile-header">Studieretning: </span>{{ member.study_program }}
                        {% endif %}
                    </td>
                    <td data-sort="{{ member.card_number }}">
                        {% if member.card_number %}
                            <span class="mobile-header">Kortnummer: </span>{{ member.card_number }}
                        {% endif %}
                    </td>

                    {% localize off %}
                        {% with member.properties_status as properties_status %}
                            <td class="member-property-status" style="
                                    background: -webkit-linear-gradient(left, #21ba45 {{ properties_status }}%, #db2828 {{ properties_status }}%);
                                    " data-sort={{ properties_status }}>
                                <span class="mobile-header">Internsystemer: </span>
                                <div class="member-property-status-popup-trigger">{{ properties_status|floatformat:2 }}%</div>
                                <div class="ui flowing popup right transition hidden">
                                    <b>System statuser:</b>
                                    {% for property in member.memberproperty_set.all %}
                                        <div class="property-status {% if not property.value %}property-status-invalid{% endif %}">
                                            {{ property.name }}
                                        </div>
                                    {% endfor %}
                                </div>
                            </td>
                        {% endwith %}
                    {% endlocalize %}
                </tr>
            {% endfor %}
        </table>

        {% if perms.internal.can_register_new_member %}
            <a href="{% url 'new_member' %}">
                <div class="ui blue button right floated">
                    Registrer nytt medlem
                </div>
            </a>
        {% endif %}
    </div>

    <form id="delete-form" method="post">{% csrf_token %}</form>

    <script src="{% static "internal/js/member-list.js" %}"></script>
{% endblock body %}


